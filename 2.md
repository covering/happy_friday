# Extension System for Biz API

优秀的软件系统都支持extension, 比如Firefox, Chrome, VSCode, Eclipse, Android Studio, Office, 微信小程序, spring, jupyter, grafana. 

Extension可以很好地处理业务开发领域的各种"试验". 动态添加卸载, 动态开启关闭, 这些都是支持各种新试验的必须. 更不用说, 试验代码和主逻辑的隔离. 

然而一个拓展系统本身, 可能就比业务本身还要复杂, 这是业务开发难以接受的. 有没有可能实现一种超级简单的Extension System, 可以几乎没有成本的应用到所有API的开发呢?

当然可以的. 它所需要的, 就是**突破限制的思维方式**. 

## Extension System Rethink

要实现Extension System, 让我们来看一下, 在Extension System中, 真正吸引我们的是什么.
1. 系统的核心功能和拓展功能的隔离. 拓展功能的开发, 不影响核心功能.
2. 明确的拓展点. 拓展功能只会通过拓展点接入, 能力可控, 易于管理.
3. 拓展系统的开启, 关闭, 安装, 卸载, 和核心系统无关.

大部分的拓展系统, 一般会有比较稳定的架构, 和稳定的拓展点. 可以发现, 在业务逻辑的开发中, 这个假设其实不是很成立. 

作为服务端业务API, 如果是需要通过修改代码来实现的功能, 都会需要重新上线; 而功能的开关, 一般都有配置系统的来控制. 因此, "拓展系统的开启, 关闭, 安装, 卸载", 对于后端服务, 没有意义.

同理, 完全的代码隔离, 就会需要完整的系统设计. 而在API开发的过程中, 更重要的是业务, 而不是系统本身. 所以隔离, 并不需要那么严格.

似乎, 陷入了死胡同? 我们重新思考这个可读性的分析, 为什么需要拓展系统. 我们想要的是: 业务的拓展, 不影响核心功能的逻辑. 核心功能的逻辑又是指什么? 回顾第一章, slides的outline. 那么, 这些outline, 是不是正好可以用的extension point呢? 

就像写slides一样, 首先, 我们会准备outline, 以及一些碎片化的页面. 其次, 我们不断地**填充页面, 调整outline**. 这不就是开发的过程吗? 

深入思考一下, 我们并不需要一个完整的Extension System, 而是**需要开发者, 以Extension System的方式, 来组织代码**! 因为, 这个拓展系统, 不是为了动态加载功能, 而是为了清晰地组织代码. 因此, 我们完全不需要实现, 而只需要**确保这种协同开发的代码组织方式**.

## Static Extension System

如果核心代码已经有了outline, 那么feature代码, 多数情况不会修改outline, 而只是在outline的某个步骤, 多做一点工作. 如果需要突破outline的限制, 那么可以: 
1. 添加outline, 比如 pre_step_2. 这是不是一下子就很有Extension System的范儿了?
2. 调整outline. 

请特别注意, 我们维护的是整个API. 调整outline, 重构/重写整个API都是允许的. outline是用来帮助理解代码, 而不是限制开发者的. 随着业务的发展, 迟早会要重构API. outline的存在就是为了方便重构时清晰地理解代码, 而**重构之后, outline会比之前更加清晰**.

一种随着业务迭代, 变得更加清晰的组织方式. 




